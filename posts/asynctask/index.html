<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Asynctask | A weird person wrote this, probably</title>
  <link rel = 'canonical' href = 'https://vk1cd314.github.io/posts/asynctask/'>
  <meta name="description" content="Hello there you somehow managed to get here, congrats on that, this just happens to be my blog">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Asynctask" />
<meta property="og:description" content="AsyncTask This tutorial on AsyncTask is for the kotlin programming language. It can easily be adapted for the java programming language All source codes can be found in the GIt Repositroy linked
A program running on a single thread performs its tasks synchronously - meaning it waits till one task is complete till starting with another. On an android application UI runs on the main thread. The rendering of UI takes place in microsecond range." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://vk1cd314.github.io/posts/asynctask/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-10T20:23:16+06:00" />
<meta property="article:modified_time" content="2022-09-10T20:23:16+06:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Asynctask"/>
<meta name="twitter:description" content="AsyncTask This tutorial on AsyncTask is for the kotlin programming language. It can easily be adapted for the java programming language All source codes can be found in the GIt Repositroy linked
A program running on a single thread performs its tasks synchronously - meaning it waits till one task is complete till starting with another. On an android application UI runs on the main thread. The rendering of UI takes place in microsecond range."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://vk1cd314.github.io/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css" integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N&#43;XoIuZg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://vk1cd314.github.io/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&text=Asynctask" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&title=Asynctask" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&is_video=false&description=Asynctask" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Asynctask&body=Check out this article: https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&title=Asynctask" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&title=Asynctask" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&name=Asynctask&description=AsyncTask%20This%20tutorial%20on%20AsyncTask%20is%20for%20the%20kotlin%20programming%20language.%20It%20can%20easily%20be%20adapted%20for%20the%20java%20programming%20language%20All%20source%20codes%20can%20be%20found%20in%20the%20GIt%20Repositroy%20linked%0aA%20program%20running%20on%20a%20single%20thread%20performs%20its%20tasks%20synchronously%20-%20meaning%20it%20waits%20till%20one%20task%20is%20complete%20till%20starting%20with%20another.%20On%20an%20android%20application%20UI%20runs%20on%20the%20main%20thread.%20The%20rendering%20of%20UI%20takes%20place%20in%20microsecond%20range." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&t=Asynctask" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#declaration">Declaration</a></li>
    <li><a href="#making-a-network-call">Making a network call</a></li>
    <li><a href="#communicating-with-other-threads">Communicating with other threads</a></li>
    <li><a href="#cautions">Cautions</a></li>
    <li><a href="#errors-to-expect">Errors to Expect</a></li>
    <li><a href="#referenes">Referenes</a></li>
    <li><a href="#git-repository">Git Repository</a></li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Asynctask
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2022-09-10 20:23:16 &#43;0600 &#43;06" itemprop="datePublished">2022-09-10</time>
          
        </div>
        
        
        
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <h1 id="asynctask">AsyncTask</h1>
<blockquote>
<p>This tutorial on AsyncTask is for the kotlin programming language. It can easily be adapted for the java programming language
All source codes can be found in the GIt Repositroy linked</p>
</blockquote>
<p>A program running on a single thread performs its tasks synchronously - meaning it waits till one task is complete till starting with another. On an android application UI runs on the main thread. The rendering of UI takes place in microsecond range. So for tasks like network calls that take significantly more time (in the millisecond range), the UI thread would be held up while the other task is finished if both were run on the main thread.</p>
<p>This is where AsyncTask is needed. It hands the secondary task to another thread and waits for a callback upon completion of the task.</p>
<p>For this tutorial we shall use AsyncTask to make a “GET” request to a API and see the result</p>
<h2 id="declaration">Declaration</h2>
<p>AsyncTask is an abstract generic class that needs to be implemented to use its functionality. To make a class extend AsyncTask, the generic class needs three parameters - </p>
<ul>
<li><em>Parameters</em> - to pass onto any parameter into class, used as parmeters for the network call</li>
<li><em>Progress</em> - To keep track of progress updates</li>
<li><em>Result</em> - Format of the result expected</li>
</ul>
<p>We declare class <em>ApiCall</em> to implement our <em>AsyncTask.</em> The argument types are taken in order <em>&lt;Params, Progress, Result&gt;</em>. We pass a string parameter and expect a string returned from the API. So declare the class like</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiCall</span>: AsyncTask&lt;String, Void, String&gt;() {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>AsyncTask is an abstract method. We need to override some of the methods in the class. The only method compulsory to override is <em>doInBackground.</em> This method accepts a variable list of “Params” type arguments and returns the result. We passed a String type for the parameters so our <em>doInBackground</em> has a variable list of strings. We expect a JSONObject responce from out api, so the <em>Result</em> is JSOBObject type.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiCall</span>: AsyncTask&lt;String, Void, JSONObject&gt;() {  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">doInBackground</span>(<span style="color:#66d9ef">vararg</span> <span style="color:#66d9ef">param</span>: String?): JSONObject? {  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>  
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This method does the heavy lifting of the network call and actions inside it are executed in the background while the UI thread keeps running. There are also some very useful methods that can be implemented inside the class. We shall overriding the following methods for our this tutorial</p>
<ul>
<li><em>onPreExecute</em>: Takes no arguments as parameter and returns nothing. This method is executed immediately before the <em>doInBackground</em> that we have overridden. We can use this to perform any task to set up the process.</li>
<li><em>onPostExecute</em>: Takes one single argument of type “Result” (String in our case) and returns nothing. It is executed immediately after <em>doInBackground</em>. This is used to take actions after receiving the result - like updating the UI.</li>
<li><em>onProgressUpdate</em>: This takes one single “Progress” (Void in our case) type argument and returns nothing. It is used to keep tabs on the progress of the task in this thread. Its actions are discussed later.</li>
</ul>
<p>The skeleton of our <em>ApiCall</em> now looks like this</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiCall</span>: AsyncTask&lt;String, Void, JSONObject&gt;() {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onPreExecute</span>() {  
</span></span><span style="display:flex;"><span>       
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">doInBackground</span>(<span style="color:#66d9ef">vararg</span> <span style="color:#66d9ef">param</span>: String?): JSONObject? {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onProgressUpdate</span>(<span style="color:#66d9ef">vararg</span> values: Void?) {  
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onPostExecute</span>(result: JSONObject?) {  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="making-a-network-call">Making a network call</h2>
<p>For this tutorial we use the free online mangadex api. We will make a simple GET request to get a list of manga URLs. Kotlin uses the java.net packages to make simple network calls. </p>
<p>URL to mangadex - <a href="https://api.mangadex.org">https://api.mangadex.org</a></p>
<p><strong>To make a network call your application must have network permissions enabled. Inside the AndroidManifest.xml. Your xml file should look like this</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;manifest&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;uses-permission</span> <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;android.permission.INTERNET&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;uses-permission</span> <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;android.permission.ACCESS_NETWORK_STATE&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/manifest&gt;</span>
</span></span></code></pre></div><p>For the API call we store the link to the API in a constant and keep a variable to store the expected result value. Let’s make a request to the “/manga” endpoint of the api. We open the string as an URL and try to open a connection as a HTTPUrlConnection (from java.net package)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>	<span style="color:#66d9ef">val</span> tag = <span style="color:#e6db74">&#34;API - call&#34;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> api_url = <span style="color:#e6db74">&#34;https://api.mangadex.org&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">doInBackground</span>(<span style="color:#66d9ef">vararg</span> <span style="color:#66d9ef">param</span>: String?): String {  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> endpoint = <span style="color:#66d9ef">param</span>[<span style="color:#ae81ff">0</span>]  
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// https://api.mangadex.org/manga  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">val</span> url = URL(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$api</span><span style="color:#e6db74">_url/</span><span style="color:#e6db74">$endpoint</span><span style="color:#e6db74">&#34;</span>)  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> conn = url.openConnection() <span style="color:#66d9ef">as</span> HttpURLConnection  
</span></span><span style="display:flex;"><span>        conn.requestMethod = <span style="color:#e6db74">&#34;GET&#34;</span>  
</span></span><span style="display:flex;"><span>        conn.connect()  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">val</span> output = StringBuilder()
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> output.toString();  
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>If the connection is established successfully the <em>conn</em> object produces an <em>inputStream</em> that we can read using basic IO</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">doInBackground</span>(<span style="color:#66d9ef">vararg</span> <span style="color:#66d9ef">param</span>: String?): JSONObject {  
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">val</span> url = URL(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$api</span><span style="color:#e6db74">_url/</span><span style="color:#e6db74">${param[0]}</span><span style="color:#e6db74">&#34;</span>)  
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">val</span> conn = url.openConnection() <span style="color:#66d9ef">as</span> HttpURLConnection  
</span></span><span style="display:flex;"><span>	  conn.requestMethod = <span style="color:#e6db74">&#34;GET&#34;</span>  
</span></span><span style="display:flex;"><span>	  conn.connect()  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">val</span> inputStream = InputStreamReader(conn.inputStream)  
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">val</span> reader = BufferedReader(inputStream)  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">val</span> output = StringBuilder() 
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">var</span> line: String?;  
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">while</span>(reader.readLine().also { line = <span style="color:#66d9ef">it</span> } <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {  <span style="color:#75715e">// reader sends api responce as input stream
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	      output.append(line)  
</span></span><span style="display:flex;"><span>	  }  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">return</span> JSONObject(output.toString())  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We create an <em>inputStream</em> object from the connection and read it using a <em>BufferedReader.</em> For every line we read, we append it onto the output object we declared earlier. Finally we return the output as a string since it’s our result. </p>
<p>To view the result, we can print the result inside the <em>onPostExecute</em> method to check if the network call returned our expected value. This method is called immediately after the <em>doInBackground</em> method with the returned result.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onPostExecute</span>(result: JSONObject?) {  
</span></span><span style="display:flex;"><span>  	Log.i(tag, result<span style="color:#f92672">!!</span>.toString())  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Expected Log can be seen on this link: <a href="https://api.mangadex.org/manga">https://api.mangadex.org/manga</a></p>
<p>During the <em>doInBackground</em> method we could keep track of the progress of the network call. Say we pass a list of endpoints and are making calls to each one of them. We can keep updating the progress by calling the <em>publishProgress(Progress)</em> method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">doInBackground</span>(<span style="color:#66d9ef">vararg</span> <span style="color:#66d9ef">param</span>: String?): JSONObject {  
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">val</span> url = URL(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$api</span><span style="color:#e6db74">_url/</span><span style="color:#e6db74">${param[0]}</span><span style="color:#e6db74">&#34;</span>)  
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">val</span> conn = url.openConnection() <span style="color:#66d9ef">as</span> HttpURLConnection  
</span></span><span style="display:flex;"><span>	  conn.requestMethod = <span style="color:#e6db74">&#34;GET&#34;</span>  
</span></span><span style="display:flex;"><span>	  conn.connect()  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">val</span> inputStream = InputStreamReader(conn.inputStream)  
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">val</span> reader = BufferedReader(inputStream)  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">val</span> output = StringBuilder()  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">var</span> line: String?;  
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">while</span>(reader.readLine().also { line = <span style="color:#66d9ef">it</span> } <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {  
</span></span><span style="display:flex;"><span>	      publishProgress() <span style="color:#75715e">// PROGRESS UPDATE  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	      output.append(line)  
</span></span><span style="display:flex;"><span>	  }  
</span></span><span style="display:flex;"><span>	  Log.i(tag, output.toString())  
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">return</span> output.toString();  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Every time we call the <em>publishProgress()</em> method, the task calls the <em>onProgressUpdate</em> method. To every time we receive a new line we can update the user on the progress</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onProgressUpdate</span>(<span style="color:#66d9ef">vararg</span> values: Void?) {  
</span></span><span style="display:flex;"><span>  	Log.i(tag, <span style="color:#e6db74">&#34;New Line Received&#34;</span>)  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The task can also be canceled at any point in time by calling the cancel(boolean) method. This will execute the <em>onCancelled()</em> methode. It is always a good idea to override this methode</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCancelled</span> () {
</span></span><span style="display:flex;"><span>	Log.e(tag, <span style="color:#e6db74">&#34;API call was cancelled&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We can call make this task execute from the UI thread by using an object of this class and calling it’s <em>execute()</em> method. To make a network call on the press of a button we could do the following</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> fetchButton: Button = findViewById(R.id.mangadexfetch)  
</span></span><span style="display:flex;"><span>fetchButton.setOnClickListener {  
</span></span><span style="display:flex;"><span>  	ApiCall().execute(<span style="color:#e6db74">&#34;manga&#34;</span>)  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This passes the argument “manga” into the AsyncTask and keeps it functioning on another thread.</p>
<h2 id="communicating-with-other-threads">Communicating with other threads</h2>
<blockquote>
<p>This part of the tutorial is helpful only if you need the AsyncTask responce elsewhere.</p>
</blockquote>
<p>After or during the network call, the thread from which it is called might need to communicate with the AsyncTask thread. Case in point - we want our users to see the data that we fetched from the api in the main thread. To allow the asyncTask to communitate with the main thread, we pass the parent object into the AsyncTask object. We need an interface to help with that.</p>
<p>Create a generic interface <em>NetworkCaller</em> contains the methodes <em>onNetworkCallSuccess(Result)</em> and <em>onNetworkCallFail()</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">NetworkCaller</span>&lt;T&gt; {
</span></span><span style="display:flex;"><span>    void onNetworkCallSuccess(T t);
</span></span><span style="display:flex;"><span>    void onNetworkCallFail();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The caller object must override this interface and pass itself onto the AsyncTask object that is creates to allow the AsyncTask to execute these methodes when they need. Modify the caller activity to override the <em>NetworkCaller</em> interface. Now we can pass the caller object into the AsyncTask.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MainActivity</span> : AppCompatActivity(), NetworkCaller&lt;JSONObject&gt; { <span style="color:#75715e">// implenets the NetworkCaller interface with the expected result type *JSONObject*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> tag = <span style="color:#e6db74">&#34;Main&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreate</span>(savedInstanceState: Bundle?) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span>.onCreate(savedInstanceState)
</span></span><span style="display:flex;"><span>        setContentView(R.layout.activity_main)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> apicallbutton = findViewById&lt;Button&gt;(R.id.presstoinvoteapi);
</span></span><span style="display:flex;"><span>        apicallbutton.setOnClickListener {
</span></span><span style="display:flex;"><span>            ApiCall(<span style="color:#66d9ef">this</span>).execute(<span style="color:#e6db74">&#34;manga&#34;</span>) <span style="color:#75715e">// passing *this* into ApiCall object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Overrides NetworkCaller methodes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onNetworkCallSuccess</span>(result: JSONObject?) {
</span></span><span style="display:flex;"><span>        Log.i(tag, result.toString())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onNetworkCallFail</span>() {
</span></span><span style="display:flex;"><span>        Log.e(tag, <span style="color:#e6db74">&#34;Network Call Failed&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The ApiCall initialization now looks like <code>class ApiCall(val parent: NetworkCaller&lt;JSONObject&gt;): AsyncTask&lt;String, Void, JSONObject&gt;()</code> - Accepting a parent object that implements NetworkCaller.  We can now handle post_execute and network cancellations differently</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// inside the ApiCall class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onPostExecute</span>(result: JSONObject?) {
</span></span><span style="display:flex;"><span>	parent.onNetworkCallSuccess(result)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCancelled</span> () {
</span></span><span style="display:flex;"><span>	parent.onNetworkCallFail()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="cautions">Cautions</h2>
<ol>
<li>
<p><strong>The methods <em>onPreExecute(), onPostExecute(Result), doInBackground(Params&hellip;) and onProgressUpdate(Progress&hellip;)</em> SHOULD NEVER BE CALLED MANUALLY.  Use only the <em>execute()</em> method to start the task.</strong> </p>
</li>
<li>
<p><strong>Tasks can be created and executed on the UI thread only.</strong></p>
</li>
<li>
<p><strong>A Task can be executed only once.</strong></p>
</li>
</ol>
<h2 id="errors-to-expect">Errors to Expect</h2>
<p>If the network connection cannot be established, a runtime exception  is thrown</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>AndroidRuntime: FATAL EXCEPTION: AsyncTask <span style="color:#75715e">#1</span>
</span></span><span style="display:flex;"><span>Process: com.tsunderead.kotlin_api, PID: <span style="color:#ae81ff">8732</span>
</span></span></code></pre></div><blockquote>
<p>This can be due to a wrong api URL or a weak internet
Verify the URL and check internet connection</p>
</blockquote>
<p>Any critical error calls the onCancelled() method. Overriding this method is a good practice to debug network call errors.</p>
<h2 id="referenes">Referenes</h2>
<ol>
<li><a href="https://youtu.be/zHGgSd1wvxY">AsyncTask theory</a></li>
<li><a href="https://youtu.be/EThkglxLxSM">AsyncTask implementation</a></li>
<li><a href="https://developer.android.com/reference/kotlin/android/os/AsyncTask">AsyncTask documentation</a></li>
<li><a href="https://developer.android.com/reference/kotlin/java/net/HttpURLConnection">HttpURLConnection documentation</a></li>
</ol>
<h2 id="git-repository">Git Repository</h2>
<p>All source codes can be found on this repository
<a href="https://github.com/master-da/kotlin-api">https://github.com/master-da/kotlin-api</a></p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#declaration">Declaration</a></li>
    <li><a href="#making-a-network-call">Making a network call</a></li>
    <li><a href="#communicating-with-other-threads">Communicating with other threads</a></li>
    <li><a href="#cautions">Cautions</a></li>
    <li><a href="#errors-to-expect">Errors to Expect</a></li>
    <li><a href="#referenes">Referenes</a></li>
    <li><a href="#git-repository">Git Repository</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&text=Asynctask" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&title=Asynctask" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&is_video=false&description=Asynctask" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Asynctask&body=Check out this article: https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&title=Asynctask" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&title=Asynctask" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&name=Asynctask&description=AsyncTask%20This%20tutorial%20on%20AsyncTask%20is%20for%20the%20kotlin%20programming%20language.%20It%20can%20easily%20be%20adapted%20for%20the%20java%20programming%20language%20All%20source%20codes%20can%20be%20found%20in%20the%20GIt%20Repositroy%20linked%0aA%20program%20running%20on%20a%20single%20thread%20performs%20its%20tasks%20synchronously%20-%20meaning%20it%20waits%20till%20one%20task%20is%20complete%20till%20starting%20with%20another.%20On%20an%20android%20application%20UI%20runs%20on%20the%20main%20thread.%20The%20rendering%20of%20UI%20takes%20place%20in%20microsecond%20range." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fvk1cd314.github.io%2fposts%2fasynctask%2f&t=Asynctask" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  A weird person wrote this, probably 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
